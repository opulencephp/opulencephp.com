#!/usr/bin/env php
<?php
$output = [];
$statusCode = null;
$htmlDirectory = "/var/www/html";
$projectRootDirectory = realpath(__DIR__ . "/..");
$commands = [
    // Go to this project's root directory
    "cd $projectRootDirectory",
    "composer update",
    // Copy the master environment config
    "\\cp -vrf $htmlDirectory/.env.app.php configs/environment/.env.app.php",
    // Copy the fixed Sami project
    "\\cp -vrf $htmlDirectory/sami vendor",
    "composer dump-autoload -o",
    // Generate the necessary files and run tests
    "php rdev docs",
    "php rdev api",
    "chmod -R 777 tmp",
    "chmod -R 777 resources",
    "vendor/bin/phpunit"
];

exec(implode(" && ", $commands), $output, $statusCode);

foreach($output as $line)
{
    echo $line . "\n";
}

exit($statusCode);