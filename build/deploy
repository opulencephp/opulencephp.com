#!/usr/bin/env php
<?php
global $argv;
$output = [];
$statusCode = null;

if(count($argv) == 1 || strlen(trim($argv[1])) == 0)
{
    echo "No HTML directory specified\n";
    exit(1);
}

$htmlDirectory = $argv[1];
$projectRootDirectory = realpath(__DIR__ . "/..");
$commands = [
    // Go to this project's root directory
    "cd $projectRootDirectory",
    "composer update",
    // Copy the master environment config
    "\\cp -vrf $htmlDirectory/.env.app.php configs/environment/.env.app.php",
    "composer dump-autoload -o",
    // Generate the necessary files and run tests
    "php opulence docs",
    "php opulence api",
    "chmod -R 777 tmp",
    "chmod -R 777 resources",
    "php opulence framework:flushcache",
    "vendor/bin/phpunit"
];

exec(implode(" && ", $commands), $output, $statusCode);

foreach($output as $line)
{
    echo $line . "\n";
}

exit($statusCode);